\documentclass[a4paper, 12pt]{article}
\usepackage[utf8]{inputenc}  % Unicode
\usepackage[french]{babel}
\usepackage{geometry}
\usepackage{graphics}
\usepackage[pdftex]{graphicx, color}
\usepackage{pdfpages}
\DeclareGraphicsExtensions{.jpg,.png}
\pdfoutput=1
\usepackage[pdftex,
	bookmarks = true,           % Signets
	bookmarksnumbered = true,   % Signets numerotes
	pdfstartview = FitV,        % La page prend toute la hauteur
	colorlinks=true,
	citecolor=black,urlcolor=blue,linkcolor=black,
	pdfauthor={Auteur},
	pdftitle={Titre},
 	pdfsubject={Sujet},
%	pdfkeywords={},	% Besoin de keywords ?
	plainpages=false,
	pdfpagelabels,
	breaklinks=true,
   	hyperindex,
	linktocpage=true	% pour colorier seulement le numéros dans la TOC	
]{hyperref}
\usepackage{float}
\usepackage{listings}
\usepackage{alltt}
\usepackage{amsmath}
\renewcommand{\ttdefault}{txtt}

\lstset{basicstyle=\ttfamily,
escapeinside={||},
mathescape=true}
\setcounter{secnumdepth}{3}
\newcommand{\HRule}{\rule{\linewidth}{0.5mm}}

\newcommand*\styleC{\fontsize{9}{10pt}\selectfont }
\newcommand*\styleD{\fontsize{9}{10pt}\usefont{OT1}{pag}{m}{n}\selectfont }

\makeatletter
% on fixe le langage utilisé
\lstset{language=matlab}
\edef\Motscle{emph={\lst@keywords}}
\expandafter\lstset\expandafter{
}
\makeatother



\definecolor{Ggris}{rgb}{0.45,0.48,0.45}

\lstset{emphstyle=\ttfamily\color{blue}, % les mots réservés de matlab en bleu
basicstyle=\ttfamily\styleC, % 
keywordstyle=\ttfamily,
commentstyle=\color{Ggris}\styleD, % \styleD commentaire en gris
numberstyle=\tiny\color{black},
numbers=left,
numbersep=10pt,
lineskip=0.7pt,
showstringspaces=false}
%  % inclure le fichier source
\newcommand{\FSource}[1]{%
\lstinputlisting[texcl=true]{#1}
}

%%%%%%%%%
\textwidth=15cm
\textheight=21cm
%\hoffset=-2.5cm
\tolerance=9000
\hbadness=9000
\pretolerance=2500


\begin{document}
%\rmfamily

\input{title.tex}

%\begin{abstract} 
%\end{abstract} 

%{\bf Keywords:} \newline


\clearpage

\section{Introduction}

Le but de ce TP est de mettre en œuvre certaines étapes de l’algorithme de compression JPEG.

\section{Transformée en cosinus discrète (DCT)}

\subsection{Mise en œuvre de la fonction MyDCT}\label{}

Cette première fonction nous permet de calculer la transformée en cosinus discrète d'un bloc de taille 8x8.

Pour cela, nous utilisons les formules suivantes :\\

$D = X_mBY_m^T$ \\ 

avec $X_m(u,x) = \frac{1}{2}C(u) cos(\frac{(2x + 1)\pi u }{16})$ et $Y_m(v,y) = \frac{1}{2}C(v) cos(\frac{(2x + 1)\pi v }{16})$ \\

en prenant $C(0) = \frac{1}{\sqrt{2}}$ et $C(k)=1$ pour $k \in [1..7]$. \\

Les coefficient $u$ et $v$ varie de 0 à 7, donc les matrices $X_m$ et $Y_m$ ont 8 lignes. Par ailleurs, la matrice $B$ avec laquelle nous travaillons est une matrice 8x8. Ainsi, les coefficients $x$ et $y$ sont pris entre 1 et 8. On obtient donc $X_m = Y_m$. \\

Nous calculons les matrices $X_m$ et $Y_m$ en remplaçant les 4 variables $(u, v, x, y)$ dans les formules, nous multiplions les matrices $X_m$, $B$ et $Y_m$ et obtenons ainsi la matrice $D$, la transformée en cosinus discrète de $B$.\\

Le code de la fonction est en annexe \ref{dct_code}.

\subsubsection{R\'esultats}
\label{sec:Resultats}

Après avoir exécuté la fonction, nous nous rendons compte du résultat : 

\begin{alltt}
>> Bref=[	139 144 149 153 155 155 155 155;
					144 151 153 156 159 156 156 156;
					150 155 160 163 158 156 156 156;
					159 161 162 160 160 159 159 159;
					159 160 161 162 162 155 155 155;
					161 161 161 161 160 157 157 157;
					162 162 161 163 162 157 157 157;
					162 162 161 161 163 158 158 158];

>> BrefDCT = MyDCT(Bref)

BrefDCT =

   1.0e+03 *

 1.2596   -0.0010   -0.0121   -0.0052    0.0021   -0.0017   -0.0027    0.0013
-0.0226   -0.0175   -0.0062   -0.0032   -0.0029   -0.0001    0.0004   -0.0012
-0.0109   -0.0093   -0.0016    0.0015    0.0002   -0.0009   -0.0006   -0.0001
-0.0071   -0.0019    0.0002    0.0015    0.0009   -0.0001   -0.0000    0.0003
-0.0006   -0.0008    0.0015    0.0016   -0.0001   -0.0007    0.0006    0.0013
 0.0018   -0.0002    0.0016   -0.0003   -0.0008    0.0015    0.0010   -0.0010
-0.0013   -0.0004   -0.0003   -0.0015   -0.0005    0.0017    0.0011   -0.0008
-0.0026    0.0016   -0.0038   -0.0018    0.0019    0.0012   -0.0006   -0.0004
\end{alltt}

La matrice $BrefDCT$ correspond au résultat souhaité. \\



\section{Quantification}

Cette partie nous permet de calculer une matrice de quantification, qui nous permettra ensuite de quantifier le bloc après la DCT. Le bloc quantifié s'obtient en divisant chacun des coefficients après la transformée en cosinus discrète par le facteur de quantification situé à la même position dans la matrice de quantification $QM$ :
	\[ Dq(i,j) = \left\lfloor \frac{D(i,j)}{QM(i,j)} + 0.5 \right\rfloor
	\]
	

L'oeil humain étant sensible aux fréquences basses (situées dans le coin supérieur gauche de la matrice après DCT), nous devons diviser ces coefficients par un facteur faible. Voici la matrice utilisée pour un facteur $\textit{Quality} = 50$ :  \\

QM = \begin{bmatrix}
	16 & 11 & 10 & 16 & 24  & 40  & 51  & 61  \\
	12 & 12 & 14 & 19 & 26  & 58  & 60  & 55  \\
	14 & 13 & 16 & 24 & 40  & 57  & 69  & 56  \\
	14 & 17 & 22 & 29 & 51  & 87  & 80  & 62  \\
	18 & 22 & 37 & 56 & 68  & 109 & 103 & 77  \\
	24 & 35 & 55 & 64 & 81  & 104 & 113 & 92  \\
	49 & 64 & 78 & 87 & 103 & 121 & 120 & 101 \\
	72 & 92 & 95 & 98 & 112 & 100 & 103 & 99
\end{bmatrix} * Fq


Le facteur \textit{Quality} fourni à la fonction en paramètre d’entrée est compris entre 1 (très mauvais) et 100
(très bien). Si $Quality = 50$ alors $Fq = 1$. Afin de trouver la fonction $f()$ prenant comme paramètre \textit{Quality}, nous avons recherché du côté des standards JPEG qui nous dit :


\[ Fq(Quality) = \left\{ 
  \begin{array}{l l}
    (100 - Quality)/50 & \quad \text{$Quality \geq 50$}\\
    50/Quality & \quad \text{sinon}
  \end{array} \right.\]

Nous obtenons ainsi $Fq$. La matrice de quantification est alors modifiée en conséquence. Il faut faire attention à ce que les valeurs de la matrice soit compris entre 1 et 255. Si certaines valeurs sont plus petites (\textit{resp.} plus grandes) nous les fixons à 1 (\textit{resp.} à 255). Pour cela, nous utilisons la fonction \textit{find}, cf Annexe \ref{quant_code}.\\

Nous avons maintenant la matrice de quantification, nous pouvons alors calculer $Dq$, le bloc quantifié après la DCT : 
\begin{alltt}
Dq = round(BrefDCT./QM)
\end{alltt}


\section{Parcours en zigzag}

\section{Codage}

\section{Codage/décodage d'une image}

\newpage

\section{Conclusion}



\clearpage

%
% ANNEXE
%
\appendix

\section{Codes source MATLAB}
\subsection{Transformée en cosinus discrète d'un bloc 8x8}\label{dct_code}

\FSource{../MyDCT.m}

\newpage

\subsection{Quantification}\label{quant_code}

\FSource{../QuantM.m}

\newpage


\end{document}